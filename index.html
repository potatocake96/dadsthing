<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vic roads booking portal â€” Demo (Not Affiliated)</title>
  <meta name="description" content="Offline-friendly personal booking portal demo to assist with David Dass stroke recovery.">
  <style>
    :root{
      --bg:#f6f9fb;
      --panel:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --brand:#2bb673;       /* distinct green (not official) */
      --border:#e2e8f0;
      --focus:#1d4ed8;
      --danger:#dc2626;
      --shadow:0 2px 8px rgba(2,6,23,0.04)
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
    a{color:var(--focus);text-decoration:none}
    .container{max-width:960px;margin:0 auto;padding:16px}

    /* Intro overlay (first-load heads-up) */
    #introOverlay{position:fixed;inset:0;background:rgba(15,23,42,0.85);display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;color:#fff;z-index:100;padding:20px}
    #introOverlay.hidden{display:none}
    #introOverlay h2{font-size:24px;margin-bottom:10px;color:#a7f3d0}
    #introOverlay p{max-width:560px;margin:0 auto 16px auto;line-height:1.55;color:#e2e8f0}
    #introOverlay button{padding:12px 20px;border:none;border-radius:10px;background:#22c55e;color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.25)}

    /* Banner */
    .banner{background:linear-gradient(90deg,var(--brand),#30c37f);color:#fff}
    .banner .container{display:flex;gap:16px;align-items:center}
    .logo{display:inline-flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .logo-badge{width:36px;height:36px;border-radius:10px;background:#fff;color:var(--brand);display:grid;place-items:center;font-weight:900}
    .site-title{font-size:18px}
    nav{margin-left:auto;display:flex;gap:14px}
    nav a{color:#eafff3;opacity:.95}
    nav a[aria-current="page"]{font-weight:700;text-decoration:underline}

    /* Cards & layout */
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
    .grid{display:grid;gap:16px}
    @media(min-width:720px){.grid{grid-template-columns:1.2fr .8fr}}

    /* Form */
    label{font-size:14px;color:var(--muted)}
    .field{display:flex;flex-direction:column;gap:6px}
    input,select,button,textarea{font:inherit}
    input,select,textarea{padding:12px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;width:100%}
    input:focus,select:focus,textarea:focus{outline:3px solid color-mix(in oklab, var(--focus) 20%, transparent)}
    .row{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:560px){.row{grid-template-columns:repeat(2,1fr)}}

    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:color-mix(in oklab, var(--brand) 80%, #0000)}
    .btn.secondary{background:#eefdf4;border-color:#c7f0d8;color:#065f46}
    .btn.ghost{background:#fff}
    .btn.danger{background:#fff0f0;border-color:#fecaca;color:#b91c1c}

    /* List */
    .list{display:grid;gap:12px;margin:0;padding:0;list-style:none}
    .item{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff}
    .item h4{margin:0 0 4px 0}

    .muted{color:var(--muted)}
    .hidden{display:none}
    footer{margin-top:32px;padding:24px 0;color:#64748b;font-size:14px}

    /* Celebration overlay */
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,.45);display:grid;place-items:center;z-index:90}
    .overlay.hidden{display:none}
    .modal{position:relative;background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 16px 40px rgba(2,6,23,.25);padding:20px;max-width:560px;margin:16px}
    .modal h3{margin:0 0 6px 0;font-size:22px}
    .modal p{margin:0 0 10px 0}
    #confettiCanvas{position:fixed;inset:0;pointer-events:none}
    .noscroll{overflow:hidden}
    @keyframes pop{from{transform:scale(.95);opacity:0}to{transform:scale(1);opacity:1}}
    .modal{animation:pop .18s ease-out}
  </style>
</head>
<body>
  <!-- Heads-up overlay on first load -->
  <div id="introOverlay" role="dialog" aria-modal="true" aria-labelledby="introTitle">
    <h2 id="introTitle">Welcome</h2>
    <p>This is a <b>toy demonstration</b> inspired by the VicRoads portal â€” created to help <b>David Dass</b> with stroke recovery and cognitive exercises. It is <b>not official</b> and only runs locally on your device.</p>
    <button id="introContinue">Continue</button>
  </div>

  <!-- Celebration Overlay (on booking) -->
  <div id="celebrate" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="celebrateTitle">
    <canvas id="confettiCanvas" aria-hidden="true"></canvas>
    <div class="modal">
      <h3 id="celebrateTitle">Booking confirmed ðŸŽ‰</h3>
      <p id="celebrateText" class="muted"></p>
      <div class="actions">
        <button class="btn primary" id="celebrateAddCal">Add to calendar</button>
        <button class="btn ghost" id="celebrateCopy">Copy summary</button>
        <button class="btn" id="celebrateClose">Close</button>
      </div>
    </div>
  </div>

  <header class="banner">
    <div class="container">
      <div class="logo" role="img" aria-label="Vic roads booking portal demo logo">
        <span class="logo-badge" aria-hidden="true">VR</span>
        <span class="site-title">Vic roads booking portal<span style="font-weight:600"></span></span>
      </div>
      <nav aria-label="Primary">
        <a href="#book" aria-current="page">Book</a>
        <a href="#manage">Manage</a>
        <a href="#faq">FAQ</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Booking form -->
      <section id="book" class="card" aria-labelledby="book-title">
        <h2 id="book-title">Make a booking</h2>
        <p class="muted">Fill in the details to create an appointment. You can save it locally and show a confirmation.</p>
        <form id="bookingForm" novalidate>
          <div class="row">
            <div class="field">
              <label for="apptType">Appointment type</label>
              <select id="apptType" required>
                <option value="">Selectâ€¦</option>
                <option>Hazard Perception Test</option>
                <option>Drive Test (Car)</option>
                <option>Learner Permit Test</option>
                <option>Photo & Card Collection</option>
                <option>Registration / Transfer</option>
              </select>
            </div>
            <div class="field">
              <label for="centre">Service centre</label>
              <select id="centre" required></select>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="date">Preferred date</label>
              <input id="date" type="date" required />
            </div>
            <div class="field">
              <label for="time">Preferred time</label>
              <select id="time" required></select>
            </div>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:8px 0 16px 0">

          <div class="row">
            <div class="field">
              <label for="fullName">Full name</label>
              <input id="fullName" type="text" placeholder="e.g., Alex Nguyen" required />
            </div>
            <div class="field">
              <label for="lic">Licence / Permit number</label>
              <input id="lic" inputmode="text" pattern="[A-Za-z0-9\- ]{4,}" placeholder="ABC123 or L-123-456" required />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="name@example.com" required />
            </div>
            <div class="field">
              <label for="phone">Mobile</label>
              <input id="phone" type="tel" inputmode="tel" placeholder="04xx xxx xxx" pattern="[0-9 +()\-]{8,}" required />
            </div>
          </div>

          <div class="field">
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" rows="3" placeholder="Any extra details for your bookingâ€¦"></textarea>
          </div>

          <div class="actions" style="margin-top:8px">
            <button type="submit" class="btn primary">Create booking</button>
            <button type="button" id="saveLocal" class="btn secondary">Save locally</button>
            <button type="reset" class="btn ghost">Clear form</button>
          </div>
          <p id="formMsg" class="muted" style="margin-top:8px"></p>
        </form>

        <div id="confirm" class="item hidden" aria-live="polite" style="margin-top:12px">
          <h4>Booking created</h4>
          <p class="muted" id="confirmText"></p>
          <div class="actions">
            <button class="btn ghost" id="copySummary">Copy summary</button>
            <button class="btn ghost" id="addCalendar">Add to calendar (.ics)</button>
          </div>
        </div>
      </section>

      <!-- Manage -->
      <section id="manage" class="card" aria-labelledby="manage-title">
        <h2 id="manage-title">Manage bookings</h2>
        <p class="muted">Saved bookings live in your browser only. Delete them anytime.</p>
        <ul id="list" class="list" aria-live="polite"></ul>
        <div class="actions">
          <button class="btn ghost" id="exportJson">Export JSON</button>
          <button class="btn danger" id="deleteAll">Delete all</button>
        </div>
        <p id="manageMsg" class="muted" style="margin-top:8px"></p>
      </section>
    </div>

    <!-- FAQ / Help -->
    <section id="faq" class="card" style="margin-top:16px">
      <h2>FAQ</h2>
      <details open>
        <summary><b>Is this official?</b></summary>
        <p>No. This is a personal, offline-friendly demonstration and is <b>not affiliated</b> with any government agency. It exists to support cognitive rehab exercises.</p>
      </details>
      <details>
        <summary><b>Where is my data stored?</b></summary>
        <p>On your device only, using <b>localStorage</b>. Clearing your browser data removes it.</p>
      </details>
      <details>
        <summary><b>Can I run this on my phone?</b></summary>
        <p>Yes. Save this page as a file and open it in your mobile browser. It has no external dependencies.</p>
      </details>
    </section>

    <footer>
      <p>Â© <span id="year"></span> Booking demo. <span class="muted">Unaffiliated. Educational use only.</span></p>
    </footer>
  </main>

  <script>
  // ------- Utilities -------
  const getById = (id)=>document.getElementById(id);
  const centres = [
    "Abbotsford (Hoddle St)","Bendigo","Box Hill","Bundoora","Carlton","Dandenong",
    "Frankston","Geelong","Kew","Melton","Moorabbin","Pakenham","Shepparton","Sunshine","Werribee"
  ];

  const timesForDate = (dateStr)=>{
    // Generate half-hour slots between 9:00â€“16:30, skip a few at random
    const out=[]; const base = new Date(dateStr+"T09:00:00");
    for(let i=0;i<16;i++){ // 9:00 to 16:30 = 16 slots
      const t = new Date(base.getTime()+i*30*60000);
      const hh = String(t.getHours()).padStart(2,'0');
      const mm = String(t.getMinutes()).padStart(2,'0');
      out.push(`${hh}:${mm}`);
    }
    const remove = Math.floor(Math.random()*5);
    for(let j=0;j<remove;j++){
      if(out.length>0){ out.splice(Math.floor(Math.random()*out.length),1); }
    }
    return out;
  };

  const storeKey = 'vr-bookings-v1';
  const loadAll = ()=> JSON.parse(localStorage.getItem(storeKey)||'[]');
  const saveAll = (arr)=> localStorage.setItem(storeKey, JSON.stringify(arr));

  // ------- Init selects -------
  function initCentres(){
    const sel = getById('centre'); sel.innerHTML = '<option value="">Selectâ€¦</option>' + centres.map(c=>`<option>${c}</option>`).join('');
  }
  function initDate(){
    const d = getById('date');
    const minDate = new Date();
    minDate.setDate(minDate.getDate() + 7); // earliest booking is 1 week away
    const y = minDate.getFullYear();
    const m = String(minDate.getMonth()+1).padStart(2,'0');
    const da = String(minDate.getDate()).padStart(2,'0');
    const minStr = `${y}-${m}-${da}`;
    d.min = minStr;
    if(!d.value || d.value < minStr){ d.value = minStr; }
  }
  function initTimes(){
    const t = getById('time'); t.innerHTML = '<option value="">Selectâ€¦</option>';
    const ds = getById('date').value; if(!ds) return;
    timesForDate(ds).forEach(v=>{ const o=document.createElement('option'); o.textContent=v; t.appendChild(o); });
  }

  // ------- Render list -------
  function renderList(){
    const ul = getById('list'); ul.innerHTML='';
    const items = loadAll();
    if(items.length===0){ ul.innerHTML = '<li class="item"><span class="muted">No saved bookings yet.</span></li>'; return; }
    items.forEach((b,idx)=>{
      const li = document.createElement('li'); li.className='item';
      li.innerHTML = `<h4>${b.apptType} â€” ${b.date} ${b.time}</h4>
        <p class="muted">${b.centre}</p>
        <p><b>${b.fullName}</b> Â· ${b.email} Â· ${b.phone}</p>`;
      const actions = document.createElement('div'); actions.className='actions';
      const del = document.createElement('button'); del.className='btn danger'; del.textContent='Delete';
      del.addEventListener('click',()=>{ const all=loadAll(); all.splice(idx,1); saveAll(all); renderList(); msg('manageMsg','Deleted.'); });
      const copy = document.createElement('button'); copy.className='btn ghost'; copy.textContent='Copy';
      copy.addEventListener('click',()=> navigator.clipboard.writeText(summaryText(b)) );
      actions.append(copy, del); li.appendChild(actions); ul.appendChild(li);
    });
  }

  // ------- Helpers -------
  function getFormData(){
    const data = {
      apptType: getById('apptType').value.trim(),
      centre: getById('centre').value.trim(),
      date: getById('date').value,
      time: getById('time').value,
      fullName: getById('fullName').value.trim(),
      lic: getById('lic').value.trim(),
      email: getById('email').value.trim(),
      phone: getById('phone').value.trim(),
      notes: getById('notes').value.trim(),
      createdAt: new Date().toISOString()
    };
    return data;
  }

  function valid(data){
    const required = ['apptType','centre','date','time','fullName','lic','email','phone'];
    for(const k of required){ if(!data[k]) return false; }
    // Enforce 7-day min even if user types a date earlier than min
    const min = new Date(); min.setDate(min.getDate()+7);
    const picked = new Date(`${data.date}T00:00:00`);
    if(picked < new Date(min.getFullYear(),min.getMonth(),min.getDate())) return false;
    return true;
  }

  function summaryText(b){
    return `Vic roads booking portal\n\nType: ${b.apptType}\nCentre: ${b.centre}\nWhen: ${b.date} at ${b.time}\nName: ${b.fullName}\nLicence: ${b.lic}\nEmail: ${b.email}\nPhone: ${b.phone}\nNotes: ${b.notes || '-'}\n\nThis is a personal demo only.`;
  }

  function msg(id,text){ const el=getById(id); el.textContent=text; setTimeout(()=>{el.textContent='';}, 3500); }

  function showConfirm(b){
    getById('confirmText').textContent = `${b.apptType} at ${b.centre} on ${b.date} ${b.time} for ${b.fullName}.`;
    getById('confirm').classList.remove('hidden');
    openCelebrate(b);
  }

  function toICS(b){
    // minimal ICS
    const dt = new Date(`${b.date}T${b.time}:00`);
    const dtStart = dt.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
    const dtEnd = new Date(dt.getTime()+45*60000).toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
    const uid = `demo-${crypto.randomUUID?.() || Math.random().toString(36).slice(2)}@local`;
    const ics = [
      'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Demo//Vic roads booking demo//EN','BEGIN:VEVENT',
      `UID:${uid}`,`DTSTAMP:${dtStart}`,`DTSTART:${dtStart}`,`DTEND:${dtEnd}`,
      `SUMMARY:${b.apptType} (Demo)`,`LOCATION:${b.centre}`,
      `DESCRIPTION:${summaryText(b).replace(/\n/g,'\\n')}`,'END:VEVENT','END:VCALENDAR'
    ].join('\r\n');
    return new Blob([ics],{type:'text/calendar'});
  }

  // ------- Celebration / Confetti -------
  let confettiRAF=null, confettiParticles=[]; let confettiCanvas, cctx; let confettiTimer=null;
  function sizeCanvas(){ if(!confettiCanvas) return; confettiCanvas.width=innerWidth*devicePixelRatio; confettiCanvas.height=innerHeight*devicePixelRatio; cctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0); }
  function rand(min,max){ return Math.random()*(max-min)+min; }
  function spawnConfetti(){
    const colors=['#16a34a','#22c55e','#86efac','#1d4ed8','#60a5fa','#93c5fd','#f59e0b','#fbbf24','#fde68a'];
    for(let i=0;i<180;i++){
      confettiParticles.push({
        x: rand(0, innerWidth), y: rand(-40, -10), r: rand(2,5),
        vx: rand(-1,1), vy: rand(2,5), rot: rand(0,360), vr: rand(-6,6),
        color: colors[Math.floor(Math.random()*colors.length)],
        shape: Math.random()<0.5?'rect':'circle', alpha: 1
      });
    }
  }
  function drawConfetti(){
    cctx.clearRect(0,0,innerWidth,innerHeight);
    confettiParticles.forEach(p=>{
      cctx.save(); cctx.globalAlpha=p.alpha; cctx.translate(p.x,p.y); cctx.rotate(p.rot*Math.PI/180);
      cctx.fillStyle=p.color;
      if(p.shape==='rect'){ cctx.fillRect(-p.r*1.2,-p.r*0.6,p.r*2.4,p.r*1.2); }
      else { cctx.beginPath(); cctx.arc(0,0,p.r,0,Math.PI*2); cctx.fill(); }
      cctx.restore();
      p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.rot+=p.vr; if(p.y>innerHeight+20) p.y=rand(-60,-20), p.x=rand(0,innerWidth);
    });
    confettiRAF=requestAnimationFrame(drawConfetti);
  }
  function startConfetti(){
    if(!confettiCanvas){ confettiCanvas=document.getElementById('confettiCanvas'); cctx=confettiCanvas.getContext('2d'); window.addEventListener('resize', sizeCanvas); }
    sizeCanvas(); confettiParticles=[]; spawnConfetti(); drawConfetti();
    clearTimeout(confettiTimer); confettiTimer=setTimeout(()=>{ stopConfetti(); }, 5000);
  }
  function stopConfetti(){ if(confettiRAF){ cancelAnimationFrame(confettiRAF); confettiRAF=null; } if(cctx){ cctx.clearRect(0,0,innerWidth,innerHeight); } }

  function openCelebrate(b){
    const ov=document.getElementById('celebrate');
    document.getElementById('celebrateText').textContent = `${b.apptType} at ${b.centre} on ${b.date} ${b.time} for ${b.fullName}.`;
    ov.classList.remove('hidden'); document.body.classList.add('noscroll'); startConfetti();
  }
  function closeCelebrate(){ document.getElementById('celebrate').classList.add('hidden'); document.body.classList.remove('noscroll'); stopConfetti(); }

  // ------- First-load heads-up -------
  const INTRO_KEY='vr-intro-seen-v1';
  function maybeShowIntro(){ if(localStorage.getItem(INTRO_KEY)==='1'){ getById('introOverlay').classList.add('hidden'); } }

  // ------- Event wiring & Self-tests -------
  function selfTest(){
    try{
      const sample={apptType:'Learner Permit Test', centre:'Box Hill', date:'2030-01-01', time:'10:00', fullName:'Test User', lic:'ABC123', email:'t@t.com', phone:'0400000000', notes:''};
      console.assert(valid(sample)===true, 'valid() should return true for complete sample');
      console.assert(summaryText(sample).includes('Test User'), 'summaryText() should include name');
      const icsBlob = toICS(sample); console.assert(icsBlob && icsBlob.type==='text/calendar', 'toICS() should return calendar blob');
      // extra tests
      const ts = timesForDate('2030-01-01');
      console.assert(Array.isArray(ts) && ts.length>=11 && ts.length<=16, 'timesForDate() length should be between 11 and 16');
      console.assert(/^\d{2}:\d{2}$/.test(ts[0]), 'timesForDate() items should be HH:MM');
      console.assert(centres.includes('Box Hill'), 'centres should contain Box Hill');
      // min date enforcement test (synthetic)
      const today = new Date(); const min = new Date(today); min.setDate(min.getDate()+7);
      const minStr = `${min.getFullYear()}-${String(min.getMonth()+1).padStart(2,'0')}-${String(min.getDate()).padStart(2,'0')}`;
      console.assert(typeof getById('date').min === 'string' && getById('date').min === minStr, 'date.min should be today+7 days');
      console.log('Self-tests passed');
    }catch(err){ console.warn('Self-tests failed', err); }
  }

  document.addEventListener('DOMContentLoaded',()=>{
    // first-load intro
    maybeShowIntro();
    getById('introContinue').addEventListener('click',()=>{ getById('introOverlay').classList.add('hidden'); localStorage.setItem(INTRO_KEY,'1'); });

    // celebration controls
    document.getElementById('celebrateClose').addEventListener('click', closeCelebrate);
    document.getElementById('celebrate').addEventListener('click', (e)=>{ if(e.target.id==='celebrate') closeCelebrate(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeCelebrate(); });
    document.getElementById('celebrateCopy').addEventListener('click',()=>{ const b=getFormData(); if(!valid(b)) return; navigator.clipboard.writeText(summaryText(b)); });
    document.getElementById('celebrateAddCal').addEventListener('click',()=>{ const b=getFormData(); if(!valid(b)) return; const blob=toICS(b); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`booking-${b.date}-${b.time}.ics`; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000); });

    // init form + data
    initCentres(); initDate(); renderList(); getById('year').textContent=new Date().getFullYear();
    getById('date').addEventListener('change', initTimes);
    // populate initial times for the enforced min date
    initTimes();

    getById('bookingForm').addEventListener('submit', (e)=>{
      e.preventDefault(); const b=getFormData();
      if(!valid(b)){ msg('formMsg','Please complete all required fields. (Earliest available date is in 7 days.)'); return; }
      showConfirm(b); msg('formMsg','Created a booking (demo). You can also save it locally.');
    });

    getById('saveLocal').addEventListener('click',()=>{
      const b=getFormData(); if(!valid(b)){ msg('formMsg','Please complete all required fields before saving. (Earliest available date is in 7 days.)'); return; }
      const all = loadAll(); all.unshift(b); saveAll(all); renderList(); msg('manageMsg','Saved locally.');
    });

    getById('copySummary').addEventListener('click',()=>{
      const b=getFormData(); if(!valid(b)) return; navigator.clipboard.writeText(summaryText(b));
    });

    getById('addCalendar').addEventListener('click',()=>{
      const b=getFormData(); if(!valid(b)) return;
      const blob = toICS(b); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download=`booking-${b.date}-${b.time}.ics`; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    getById('exportJson').addEventListener('click',()=>{
      const data = JSON.stringify(loadAll(), null, 2);
      const blob = new Blob([data],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='bookings.json'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    getById('deleteAll').addEventListener('click',()=>{
      if(confirm('Delete ALL saved bookings?')){ localStorage.removeItem(storeKey); renderList(); msg('manageMsg','All deleted.'); }
    });

    // self-tests
    selfTest();
  });
  </script>
</body>
</html>
